<navigation-bar title="æ™ºäº«å…»è€" back="{{false}}" bindtap="readText" data-text="æ™ºäº«å…»è€">
  <view slot="left">
    <view class="weather-widget" bindtap="readText" data-text="{{weather.city}}{{weather.desc}}{{weather.temp}}åº¦">
      <text class="weather-icon">{{weather.icon}}</text>
      <view class="weather-info">
        <text class="weather-temp">{{weather.temp}}Â°</text>
        <text class="weather-city">{{weather.city}} {{weather.desc}}</text>
      </view>
      </view>
    </view>
  <view slot="center">
    <view class="data-status-bar" bindtap="showDataEntry">
      <view class="status-dot {{healthStats.status === 'abnormal' ? 'dot-red' : 'dot-green'}}"></view>
      <text class="status-text">æ•°æ®åœ¨çº¿</text>
      <text class="source-icon">{{healthStats.sourceIcon || 'âŒš'}}</text>
    </view>
  </view>
</navigation-bar>

<scroll-view class="scrollarea" scroll-y>
  <view class="nav-placeholder" style="height: 41rpx; display: block; box-sizing: border-box"></view>
  <view class="main-container {{settings.bigFont ? 'big-font' : ''}}">
    <view class="header-bg-decoration"></view>
    
    <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯åŒº -->
    <view class="header-section">
    <view class="greeting-content" bindtap="readText" data-text="{{currentTimeStr}}å¥½ï¼Œ{{userInfo.nickname || userInfo.account || 'äº²çˆ±çš„ç”¨æˆ·'}}ã€‚æœ€æ–°æŠ¥å‘Šæ›´æ–°äº{{lastUpdateTime}}">
      <view class="user-greeting">
        <text class="user-name">{{userInfo.nickname || userInfo.account || 'äº²çˆ±çš„ç”¨æˆ·'}}ï¼Œ{{currentTimeStr}}å¥½ âœ¨</text>
      </view>
      <text class="report-update-time">æœ€æ–°æŠ¥å‘Šæ›´æ–°äº {{lastUpdateTime}}</text>
    </view>
    <view class="user-avatar-wrap">
      <image src="{{userInfo.avatarUrl || '/images/default.png'}}" class="avatar-img" mode="aspectFill"></image>
    </view>
  </view>

  <!-- æ ¸å¿ƒå…¥å£ï¼šå¥åº·æ‰“å¡ (æ–°å¢å¹³å®‰å®ˆæŠ¤æé†’) -->
  <view class="check-in-banner card" bindtap="navigateTo" data-url="/pages/check-in/check-in">
    <view class="check-in-left">
      <view class="check-in-icon">ğŸ“</view>
      <view class="check-in-info">
        <text class="check-in-title">ä»Šæ—¥å¥åº·æ‰“å¡</text>
        <text class="check-in-desc {{healthStats.todayChecked ? 'checked' : 'pending'}}">
          {{healthStats.todayChecked ? 'ä»Šæ—¥å·²ç­¾åˆ°ï¼Œå„¿å¥³å·²æ”¾å¿ƒ' : 'æœªç­¾åˆ°ï¼Œ20:00å°†æé†’å„¿å¥³'}}
        </text>
      </view>
    </view>
    <view class="check-in-right">
      <view class="check-in-btn-mini {{healthStats.todayChecked ? 'btn-checked' : ''}}">
        {{healthStats.todayChecked ? 'å·²å®Œæˆ' : 'å»æ‰“å¡'}}
      </view>
    </view>
  </view>

  <!-- è¶…çº§æ ¸å¿ƒåŒºï¼šèº«ä½“æŠ¥å‘Šå¡ç‰‡ -->
  <view class="report-container status-{{healthStats.status}}">
    <view class="report-card card" bindtap="navigateToHealth">
      <view class="report-header">
        <text class="report-title">ä»Šæ—¥ç”Ÿæ´»åŠ¨æ€</text>
      </view>

      <view class="overall-status-visual">
        <view class="health-score-container">
          <view class="score-circle" style="background: conic-gradient(var(--primary-color) {{(healthStats.score || 92)}}%, #f0f0f0 0);"></view>
          <view class="score-inner"></view>
          <view class="health-score-box">
            <text class="score-val">{{healthStats.score || 92}}</text>
            <text class="score-label">å¥åº·åˆ†</text>
          </view>
        </view>
        <view class="overall-status-text" bindtap="readText" data-text="æ•´ä½“çŠ¶æ€ï¼š{{healthStats.overallText}}">
          <text class="overall-label">æ•´ä½“çŠ¶æ€ï¼š</text>
          <text class="overall-val {{healthStats.status}}">{{healthStats.overallText}}</text>
        </view>
      </view>
      
      <view class="report-vitals">
        <view class="vital-row {{healthStats.heartRateStatus}}" bindtap="readText" data-text="å½“å‰å¿ƒç‡ï¼š{{healthStats.heartRate}}ï¼Œæ­£å¸¸">
          <view class="status-bar"></view>
          <view class="vital-icon-box">
            <text class="vital-emoji">â¤ï¸</text>
          </view>
          <view class="vital-content">
            <view class="vital-val-row">
              <text class="vital-val">{{healthStats.heartRate}}</text>
              <text class="vital-unit">bpm</text>
            </view>
            <text class="vital-label">å¿ƒç‡</text>
          </view>
          <view class="vital-status-tag {{healthStats.heartRateStatus}}">æ­£å¸¸</view>
        </view>

        <view class="vital-row {{healthStats.bpStatus}}" bindtap="readText" data-text="è¡€å‹ï¼š{{healthStats.bloodPressure}}ï¼Œæ­£å¸¸">
          <view class="status-bar"></view>
          <view class="vital-icon-box">
            <text class="vital-emoji">ğŸ©¸</text>
          </view>
          <view class="vital-content">
            <view class="vital-val-row">
              <text class="vital-val">{{healthStats.bloodPressure}}</text>
            </view>
            <text class="vital-label">è¡€å‹</text>
          </view>
          <view class="vital-status-tag {{healthStats.bpStatus}}">æ­£å¸¸</view>
        </view>

        <view class="vital-row {{healthStats.oxStatus}}" bindtap="readText" data-text="è¡€æ°§é¥±å’Œåº¦ï¼š{{healthStats.oxygen}}%ï¼Œä¼˜ç§€">
          <view class="status-bar"></view>
          <view class="vital-icon-box">
            <text class="vital-emoji">ğŸ’§</text>
          </view>
          <view class="vital-content">
            <view class="vital-val-row">
              <text class="vital-val">{{healthStats.oxygen}}%</text>
            </view>
            <text class="vital-label">è¡€æ°§</text>
          </view>
          <view class="vital-status-tag {{healthStats.oxStatus}}">ä¼˜ç§€</view>
        </view>

        <view class="vital-row {{healthStats.bgStatus}}" bindtap="readText" data-text="è¡€ç³–ï¼š{{healthStats.bloodGlucose}}mmol/Lï¼Œæ­£å¸¸">
          <view class="status-bar"></view>
          <view class="vital-icon-box">
            <text class="vital-emoji">ğŸ¬</text>
          </view>
          <view class="vital-content">
            <view class="vital-val-row">
              <text class="vital-val">{{healthStats.bloodGlucose}}</text>
              <text class="vital-unit">mmol/L</text>
            </view>
            <text class="vital-label">è¡€ç³–</text>
          </view>
          <view class="vital-status-tag {{healthStats.bgStatus}}">æ­£å¸¸</view>
        </view>
      </view>

      <view class="ai-summary-box" bindtap="readText" data-text="{{healthStats.aiSummary}}">
        <view class="ai-summary-tag">AI æ™ºèƒ½åˆ†æ</view>
        <text class="ai-summary-text {{healthStats.status === 'abnormal' ? 'text-red' : ''}}">{{healthStats.aiSummary}}</text>
        <text class="ai-detail-tip">AIåˆ†æåŸºäºæ‚¨çš„{{healthStats.sourceName}}æ•°æ®</text>
      </view>

      <view class="report-actions">
        <view class="action-btn" catchtap="navigateToHealth">
          <text>æŸ¥çœ‹è¯¦æƒ…</text>
          <text class="arrow">></text>
        </view>
        <view class="action-btn" catchtap="navigateToHealthConsult">
          <text>AIå†å¸®æˆ‘çœ‹çœ‹</text>
          <text class="arrow">></text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¥å…¥æ–¹å¼æç¤ºåŒº -->
  <view class="data-entry-methods card" bindtap="showDataEntry">
    <view class="entry-header">
      <text class="entry-title">æ•°æ®æ¥å…¥æ–¹å¼</text>
      <text class="entry-more">ç‚¹å‡»è®¾ç½® ></text>
    </view>
    <view class="entry-list">
      <view class="entry-item {{healthStats.sourceType === 'device' ? 'active' : ''}}">
        <view class="entry-icon-wrap">
          <text class="entry-icon">âŒš</text>
        </view>
        <text class="entry-name">è‡ªåŠ¨åŒæ­¥</text>
        <view class="active-dot" wx:if="{{healthStats.sourceType === 'device'}}"></view>
      </view>
      <view class="entry-item {{healthStats.sourceType === 'manual' ? 'active' : ''}}">
        <view class="entry-icon-wrap">
          <text class="entry-icon">ğŸ“</text>
        </view>
        <text class="entry-name">æ‰‹åŠ¨æ·»åŠ </text>
        <view class="active-dot" wx:if="{{healthStats.sourceType === 'manual'}}"></view>
      </view>
      <view class="entry-item {{healthStats.sourceType === 'family' ? 'active' : ''}}">
        <view class="entry-icon-wrap">
          <text class="entry-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦</text>
        </view>
        <text class="entry-name">å®¶äººå½•å…¥</text>
        <view class="active-dot" wx:if="{{healthStats.sourceType === 'family'}}"></view>
      </view>
    </view>
  </view>

  <!-- è¾…åŠ©åŠŸèƒ½åŒº -->
  <view class="secondary-area">
    <!-- ä½ç½®ä¿¡æ¯å¡ç‰‡ -->
    <view class="location-card card">
      <view class="location-info" bindtap="refreshLocation">
        <view class="location-header">
          <text class="location-title">å¹³å®‰ä½ç½®å®ˆæŠ¤</text>
          <text class="location-time">{{currentLocation.updateTime}} æ›´æ–°</text>
        </view>
        <view class="location-detail">
          <text class="location-icon">ğŸ“</text>
          <view class="location-text-group">
            <text class="location-address">{{currentLocation.address || 'è¯·ç‚¹å‡»è®¾ç½®æ‚¨çš„å®¶'}}</text>
            <text class="location-tip" wx:if="{{!currentLocation.address}}">ç‚¹è¿™é‡Œå‘Šè¯‰å®¶äººæ‚¨çš„ä½ç½®</text>
            <text class="location-tip" wx:else>å·²è®°ä½ï¼šè¿™æ˜¯æ‚¨çš„å¹³å®‰å®ˆæŠ¤ç‚¹</text>
          </view>
        </view>
      </view>
      <view class="location-actions-row">
        <view class="location-mini-btn" bindtap="refreshLocation">
          <text class="mini-btn-icon">ğŸ </text>
        </view>
        <view class="location-mini-btn" bindtap="shareLocationToWechat">
          <text class="mini-btn-icon">ğŸ“¤</text>
        </view>
      </view>
    </view>

    <!-- ç®€åŒ–åçš„ AI å’¨è¯¢ -->
    <view class="ai-consult-mini card" bindtap="navigateToHealthConsult" style="width: 656rpx; display: flex; box-sizing: border-box">
      <view class="ai-mini-content">
        <text class="ai-mini-title">AI å¥åº·åŠ©æ‰‹</text>
        <text class="ai-mini-desc">éšæ—¶é—®æˆ‘å¥åº·é—®é¢˜</text>
      </view>
      <text class="ai-mini-icon">ğŸ¤–</text>
    </view>
  </view>

  <!-- å¸¸é©»æ‚¬æµ®æŒ‰é’® -->
  <view class="fixed-actions" style="position: fixed; left: 560rpx; top: 1049rpx">
    <view class="add-record-btn" bindtap="showDataEntry">
      <text class="add-icon">+</text>
      <text class="add-text">æ·»åŠ è®°å½•</text>
    </view>
    
    <view class="call-btn-container {{isCallActive ? 'active' : ''}}" 
          bindtouchstart="handleCallStart" 
          bindtouchend="handleCallEnd"
          bindlongpress="handleCallLongPress">
      <view class="call-ripple" wx:if="{{isCallActive}}"></view>
      <view class="call-inner-circle">
        <text class="call-icon">ğŸ“</text>
        <text class="call-text">å‘¼å«å®¶äºº</text>
        <text class="call-sub-text">é•¿æŒ‰å‘¼å«</text>
      </view>
    </view>
  </view>
  
  <!-- æ‚¬æµ®æœ—è¯»æŒ‰é’® -->
  <movable-area class="float-read-area" wx:if="{{settings.realtimeReading}}">
    <movable-view class="float-read-btn" direction="all" x="280" y="450" bindtap="readPageContent">
      <view class="read-ripple"></view>
      <text class="read-icon">ğŸ“¢</text>
    </movable-view>
  </movable-area>

  <!-- åŸæœ‰åŠŸèƒ½çŸ©é˜µ (ä¿ç•™ä½†æ”¾åœ¨è¾ƒåä½ç½®) -->
  <view class="service-section">
    <view class="service-grid">
      <view class="service-item" bindtap="navigateToMedication">
        <view class="service-icon-box color-1">
          <text class="icon">ğŸ’Š</text>
        </view>
        <text class="service-name" bindtap="readText" data-text="æˆ‘çš„è¯ç®±">æˆ‘çš„è¯ç®±</text>
      </view>
      <view class="service-item" bindtap="navigateToFamily">
        <view class="service-icon-box color-4">
          <text class="icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</text>
        </view>
        <text class="service-name" bindtap="readText" data-text="äº²æƒ…å®ˆæŠ¤">äº²æƒ…å®ˆæŠ¤</text>
      </view>
      <view class="service-item" bindtap="navigateToCheckIn">
        <view class="service-icon-box color-3">
          <text class="icon">âœ¨</text>
        </view>
        <text class="service-name" bindtap="readText" data-text="æ¯æ—¥ç­¾åˆ°">æ¯æ—¥ç­¾åˆ°</text>
      </view>
    </view>
  </view>

  <!-- çŠ¶æ€æ¿€æ´»åçš„æç¤º -->
  <view class="call-alert-overlay" wx:if="{{isCallSent}}">
    <view class="alert-card animate-pop">
      <view class="alert-header">
        <icon type="success" size="64" color="#1890ff"></icon>
        <text class="alert-title">å‘¼å«å·²å‘å‡º</text>
        <text class="alert-subtitle">æ‚¨çš„å®¶äººå·²æ”¶åˆ°é€šçŸ¥ï¼Œè¯·ä¿æŒç”µè¯ç•…é€š</text>
      </view>
      
      <view class="alert-health">
        <view class="health-item">
          <text class="label">å¿ƒç‡</text>
          <text class="value">{{healthStats.heartRate}}</text>
        </view>
        <view class="health-item">
          <text class="label">è¡€å‹</text>
          <text class="value">{{healthStats.bloodPressure}}</text>
        </view>
      </view>

      <view class="alert-actions">
        <button class="call-phone-btn" bindtap="callGuardianAgain">å†æ¬¡æ‹¨æ‰“ç”µè¯</button>
        <button class="call-cancel-btn" bindtap="cancelCall">å·²æŠ¥å¹³å®‰</button>
      </view>
    </view>
  </view>

  <view class="footer-spacer"></view>


</view>
</scroll-view>