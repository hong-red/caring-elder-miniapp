<navigation-bar title="ç”¨è¯æé†’" back="{{false}}"></navigation-bar>

<scroll-view class="scrollarea" scroll-y>
  <view class="nav-placeholder" style="height: 110rpx; display: block; box-sizing: border-box"></view>
  <view class="medication-container {{settings.bigFont ? 'big-font' : ''}}">
    <view class="header-section">
  <view class="title-section">
    <text class="page-title" bindtap="readText" data-text="æˆ‘çš„è¯ç®±">æˆ‘çš„è¯ç®±</text>
    <text class="page-subtitle" bindtap="readText" data-text="å…± {{medications.length}} ç§åœ¨æœè¯å“">å…± {{medications.length}} ç§åœ¨æœè¯å“</text>
  </view>
    <button class="btn btn-primary btn-circle" bindtap="addMedication" hover-class="btn-hover" style="position: relative; left: 0rpx; top: -2rpx; height: 160rpx; display: flex; box-sizing: border-box">
      <text class="add-icon">+</text>
    </button>
  </view>
  
  <!-- ä»Šæ—¥ç”¨è¯è¿›åº¦ -->
  <view class="today-progress card" wx:if="{{medications.length > 0}}">
    <view class="progress-header">
      <text class="progress-title" bindtap="readText" data-text="ä»Šæ—¥ç”¨è¯è¿›åº¦">ä»Šæ—¥ç”¨è¯è¿›åº¦</text>
      <text class="progress-percent" bindtap="readText" data-text="{{progress}}%"> {{progress}}%</text>
    </view>
    <view class="progress-bar-bg">
      <view class="progress-bar-active" style="width: {{progress}}%"></view>
    </view>
    <view class="progress-footer">
      <text class="progress-tip" bindtap="readText" data-text="ä»Šæ—¥è¿˜å‰© {{remainingCount}} æ¬¡ç”¨è¯ï¼Œè®°å¾—æŒ‰æ—¶æœç”¨å“¦">ä»Šæ—¥è¿˜å‰© {{remainingCount}} æ¬¡ç”¨è¯ï¼Œè®°å¾—æŒ‰æ—¶æœç”¨å“¦</text>
    </view>
  </view>

  <!-- ç”¨è¯åˆ—è¡¨ -->
  <view class="medication-section">
    <view class="section-header">
      <text class="section-title" bindtap="readText" data-text="æ­£åœ¨æœç”¨">æ­£åœ¨æœç”¨</text>
    </view>

    <view class="medication-list">
      <view class="empty-state" wx:if="{{medications.length === 0}}">
        <view class="empty-icon">ğŸ’Š</view>
        <text class="empty-text">æ‚¨çš„è¯ç®±ç©ºç©ºå¦‚ä¹Ÿ</text>
        <button class="btn btn-primary empty-add-btn" bindtap="addMedication">ç«‹å³æ·»åŠ è¯å“</button>
      </view>
      
      <view class="medication-card card" wx:for="{{medications}}" wx:key="id">
        <view class="card-main">
          <view class="medication-icon-box">
            <text class="med-emoji">ğŸ’Š</text>
          </view>
          <view class="med-info">
            <view class="med-name-row">
              <text class="med-name">{{item.name}}</text>
              <view class="med-tag">{{item.status || 'æœç”¨ä¸­'}}</view>
            </view>
            <text class="med-dosage">{{item.dosage || 'æ¯æ—¥ 3 æ¬¡ï¼Œæ¯æ¬¡ 1 ç‰‡'}}</text>
            <text class="med-desc">{{item.desc || 'é¤ååŠå°æ—¶æœç”¨'}}</text>
            <view class="expiry-warning error" wx:if="{{item.isExpired}}">
              <text class="warning-icon">âš ï¸</text>
              <text class="warning-text">è¯¥è¯å“å·²è¿‡æœŸ</text>
            </view>
            <view class="expiry-warning warning" wx:elif="{{item.isExpiringSoon}}">
              <text class="warning-icon">â³</text>
              <text class="warning-text">å³å°†è¿‡æœŸï¼ˆå‰© {{item.daysLeft}} å¤©ï¼‰</text>
            </view>
            <view class="expiry-info" wx:elif="{{item.expiryDate}}">
              <text class="expiry-text">æœ‰æ•ˆæœŸè‡³: {{item.expiryDate}}</text>
            </view>
          </view>
        </view>
        
        <view class="card-footer">
          <view class="reminder-times">
            <text class="clock-icon">â°</text>
            <text class="time-tag">{{item.remindTime || '08:00'}}</text>
            <text class="sync-badge" wx:if="{{item.syncToCalendar}}">å·²åŒæ­¥é—¹é’Ÿ</text>
          </view>
          <view class="card-actions">
            <view class="action-btn edit" bindtap="editMedication" data-id="{{item.id}}">ç¼–è¾‘</view>
            <view class="action-btn delete" bindtap="deleteMedication" data-id="{{item.id}}">åˆ é™¤</view>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- è¿‡æœŸè¯å“/å†å²è®°å½• (ç¤ºä¾‹) -->
  <view class="medication-section historical" wx:if="{{historicalMedications.length > 0}}">
    <view class="section-header">
      <text class="section-title">å†å²è®°å½•</text>
    </view>
    <view class="medication-card card historical-card" wx:for="{{historicalMedications}}" wx:key="id">
      <view class="card-main">
        <view class="medication-icon-box gray">
          <text class="med-emoji">ğŸ“¦</text>
        </view>
        <view class="med-info">
          <text class="med-name">{{item.name}}</text>
          <text class="med-dosage">å·²åœè¯</text>
        </view>
        <button class="btn btn-outline btn-sm" bindtap="restoreMedication" data-id="{{item.id}}" hover-class="btn-hover">é‡æ–°æœç”¨</button>
      </view>
    </view>
  </view>
  
  <view class="footer-spacer"></view>

  <!-- æ‚¬æµ®æœ—è¯»æŒ‰é’® -->
  <movable-area class="float-read-area" wx:if="{{settings.realtimeReading}}">
    <movable-view class="float-read-btn" direction="all" x="280" y="450" bindtap="readPageContent">
      <view class="read-ripple"></view>
      <text class="read-icon">ğŸ“¢</text>
    </movable-view>
  </movable-area>
</view>
</scroll-view>